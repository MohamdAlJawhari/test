<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Contacts File Details</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/contact_details.css') }}">
</head>
<body>
  <main
    class="card"
    id="contact-details-root"
    data-file-name="{{ contact_file.name if contact_file else '' }}"
  >
    <header class="header">
      <h1>Contacts File Details</h1>
      {% if contact_file %}
        <p class="hint">
          Review this file and edit its name, description, columns, and rows.
        </p>
      {% else %}
        <p class="hint">Could not load this contacts file.</p>
      {% endif %}
      <div class="actions">
        <a class="link-btn" href="/">Back to Sender</a>
        {% if contact_file %}
          <a class="link-btn" href="/?existing_contacts_file={{ contact_file.name|urlencode }}">Use This File in Sender</a>
        {% endif %}
      </div>
    </header>

    <section class="section">
      {% if load_error %}
        <div class="status error">{{ load_error }}</div>
      {% endif %}

      {% if contact_file %}
        <div id="details-status" class="status" style="display: none;"></div>

        <p class="small">
          Stored file: <strong>{{ contact_file.name }}</strong><br>
          Last modified: {{ contact_file.modified_at }}<br>
          Size: {{ contact_file.size_label }}
        </p>

        <div class="row">
          <label>
            File Name
            <input id="display-name" type="text" maxlength="120" value="{{ contact_file.display_name }}">
          </label>
          <label>
            Description
            <textarea id="description" maxlength="500">{{ contact_file.description }}</textarea>
          </label>
          <div>
            <button id="save-meta-btn" type="button">Save Details</button>
          </div>
        </div>

        <p class="small">
          Table rows: {{ preview.total_rows }}. Columns: {{ preview.total_columns }}.
        </p>

        {% if preview.headers %}
          <p class="small">
            You can edit cell values and most column names. The main <strong>NUMBERS</strong> column name is locked.
          </p>
          <div class="table-toolbar">
            <button id="add-row-btn" type="button">Add Row</button>
            <button id="add-col-btn" type="button">Add Column</button>
            <button id="save-content-btn" type="button">Save File Content</button>
          </div>

          <div class="preview-wrap">
            <table class="preview-table" id="editable-table">
              <thead id="editable-head">
                <tr id="editable-head-row">
                  {% for header in preview.headers %}
                    <th>
                      <input
                        type="text"
                        class="table-input header-input"
                        value="{{ header }}"
                        {% if header|upper == "NUMBERS" %}data-locked="1" readonly{% endif %}
                      >
                    </th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody id="editable-body">
                {% for row in preview.rows %}
                  <tr>
                    {% for cell in row %}
                      <td>
                        <input type="text" class="table-input cell-input" value="{{ cell }}">
                      </td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="small">No columns found. Add a column and save.</p>
          <div class="table-toolbar">
            <button id="add-row-btn" type="button">Add Row</button>
            <button id="add-col-btn" type="button">Add Column</button>
            <button id="save-content-btn" type="button">Save File Content</button>
          </div>
          <div class="preview-wrap">
            <table class="preview-table" id="editable-table">
              <thead id="editable-head">
                <tr id="editable-head-row"></tr>
              </thead>
              <tbody id="editable-body"></tbody>
            </table>
          </div>
        {% endif %}
      {% endif %}
    </section>
  </main>

  <script src="{{ url_for('static', filename='js/contact_details.js') }}" defer></script>
</body>
</html>
