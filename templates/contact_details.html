<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Contacts File Details</title>
  <link rel="icon" href="{{ url_for('static', filename='broadcast.svg') }}" type="image/svg+xml">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/contact_details.css') }}">
</head>
<body>
  <main
    class="card"
    id="contact-details-root"
    data-file-name="{{ contact_file.name if contact_file else '' }}"
  >
    <header class="header">
      <h1 class="brand">
        <span class="brand-mark" aria-hidden="true">
          <svg class="brand-icon" viewBox="0 0 24 24" fill="none">
            <path
              d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M14 2v6h6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </span>
        Contacts File Details
      </h1>
      {% if contact_file %}
        <p class="hint">
          Review this file and edit its name, description, columns, and rows.
        </p>
      {% else %}
        <p class="hint">Could not load this contacts file.</p>
      {% endif %}
      <div class="actions">
        <a class="link-btn back-link" href="/">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path
              d="M15 18l-6-6 6-6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          Back
        </a>
        {% if contact_file %}
          <a class="link-btn use-file-btn" href="/?existing_contacts_file={{ contact_file.name|urlencode }}">
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M20 6L9 17l-5-5"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            Select File Sender
          </a>
          <a class="link-btn download-btn" href="/api/contacts/{{ contact_file.name|urlencode }}/download">
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M12 3v12"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M8 11l4 4 4-4"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M4 21h16"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            Download File
          </a>
          <button id="delete-file-btn" type="button" class="danger-btn">
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M3 6h18"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M10 11v6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M14 11v6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            Delete File
          </button>
        {% endif %}
      </div>
    </header>

    <section class="section">
      {% if load_error %}
        <div class="status error">{{ load_error }}</div>
      {% endif %}

      {% if contact_file %}
        <div id="details-status" class="status" style="display: none;"></div>

        <p class="small">
          Stored file: <strong>{{ contact_file.name }}</strong><br>
          Last modified: {{ contact_file.modified_at }}<br>
          Size: {{ contact_file.size_label }}
        </p>

        <div class="meta-row">
          <label>
            File Name
            <input id="display-name" type="text" dir="auto" maxlength="120" value="{{ contact_file.display_name }}">
          </label>
          <label>
            Description
            <textarea id="description" dir="auto" maxlength="500">{{ contact_file.description }}</textarea>
          </label>
          <div class="meta-actions">
            <button id="save-meta-btn" type="button">
              <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path
                  d="M20 6L9 17l-5-5"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              Save Details
            </button>
          </div>
        </div>

        <p class="small">
          Table rows: {{ preview.total_rows }}. Columns: {{ preview.total_columns }}.
        </p>

        {% if preview.headers %}
          <p class="small">
            Use the small <strong>[-]</strong> and <strong>[+]</strong> buttons inside each row and column to remove or insert exactly where you want.
            The main <strong>NUMBERS</strong> column name is locked.
          </p>
          <div class="table-toolbar">
            <button id="save-content-btn" type="button">
              <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path
                  d="M20 6L9 17l-5-5"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              Save File Content
            </button>
          </div>

          <div class="preview-wrap">
            <table class="preview-table" id="editable-table">
              <thead id="editable-head">
                <tr id="editable-head-row">
                  {% for header in preview.headers %}
                    <th>
                      <input
                        type="text"
                        class="table-input header-input"
                        value="{{ header }}"
                        {% if header|upper == "NUMBERS" %}data-locked="1" readonly{% endif %}
                      >
                    </th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody id="editable-body">
                {% for row in preview.rows %}
                  <tr>
                    {% for cell in row %}
                      <td>
                        <input type="text" class="table-input cell-input" value="{{ cell }}">
                      </td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="small">
            No columns found yet. A default <strong>NUMBERS</strong> column and an empty row will be prepared automatically.
            Then use the small <strong>[-]</strong> and <strong>[+]</strong> buttons for row/column control.
          </p>
          <div class="table-toolbar">
            <button id="save-content-btn" type="button">
              <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path
                  d="M20 6L9 17l-5-5"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              Save File Content
            </button>
          </div>
          <div class="preview-wrap">
            <table class="preview-table" id="editable-table">
              <thead id="editable-head">
                <tr id="editable-head-row"></tr>
              </thead>
              <tbody id="editable-body"></tbody>
            </table>
          </div>
        {% endif %}
      {% endif %}
    </section>
  </main>

  <script src="{{ url_for('static', filename='js/contact_details.js') }}" defer></script>
</body>
</html>
