<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Excel Details</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/contact_details.css') }}">
</head>
<body>
  <main
    class="card"
    id="contact-details-root"
    data-file-name="{{ contact_file.name if contact_file else '' }}"
  >
    <header class="header">
      <h1>Excel Details</h1>
      {% if contact_file %}
        <p class="hint">
          Review this file and edit its name/description.
        </p>
      {% else %}
        <p class="hint">Could not load this Excel file.</p>
      {% endif %}
      <div class="actions">
        <a class="link-btn" href="/">Back to Sender</a>
        {% if contact_file %}
          <a class="link-btn" href="/?existing_contacts_file={{ contact_file.name|urlencode }}">Use This Excel in Sender</a>
        {% endif %}
      </div>
    </header>

    <section class="section">
      {% if load_error %}
        <div class="status error">{{ load_error }}</div>
      {% endif %}

      {% if contact_file %}
        <div id="details-status" class="status" style="display: none;"></div>

        <p class="small">
          Stored file: <strong>{{ contact_file.name }}</strong><br>
          Last modified: {{ contact_file.modified_at }}<br>
          Size: {{ contact_file.size_label }}
        </p>

        <div class="row">
          <label>
            Excel Name
            <input id="display-name" type="text" maxlength="120" value="{{ contact_file.display_name }}">
          </label>
          <label>
            Description
            <textarea id="description" maxlength="500">{{ contact_file.description }}</textarea>
          </label>
          <div>
            <button id="save-btn" type="button">Save Details</button>
          </div>
        </div>

        <p class="small">
          Preview showing {{ preview.displayed_rows }} row(s){% if preview.total_rows %} out of {{ preview.total_rows }}{% endif %}{% if preview.truncated %} (limited){% endif %}.
        </p>

        {% if preview.headers %}
          <div class="preview-wrap">
            <table class="preview-table">
              <thead>
                <tr>
                  {% for header in preview.headers %}
                    <th>{{ header }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for row in preview.rows %}
                  <tr>
                    {% for cell in row %}
                      <td>{{ cell }}</td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="small">No preview data available for this file.</p>
        {% endif %}
      {% endif %}
    </section>
  </main>

  <script src="{{ url_for('static', filename='js/contact_details.js') }}" defer></script>
</body>
</html>
