<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WhatsApp Sender</title>
  <link rel="icon" href="{{ url_for('static', filename='broadcast.svg') }}" type="image/svg+xml">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
</head>
<body>
  <div class="layout">
    <div class="sidebar-stack">
      <aside class="sidebar">
        <h2 class="sidebar-title">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path
              d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M14 2v6h6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          Uploaded Contacts Files
        </h2>
        <p class="small">
          Open any file to view preview and edit details on a dedicated page.
        </p>
        <div class="upload-section">
          <button id="contacts-upload-btn" type="button" class="upload-btn">
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M12 16V4"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M8 8l4-4 4 4"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M4 20h16"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            Upload New Contacts File
          </button>
          <input
            type="file"
            name="contacts_file"
            id="contacts-file-input"
            accept=".xlsx,.xlsm,.xltx,.xltm,.csv"
            form="send-form"
            class="hidden-file-input"
          >
        </div>
        <p class="small">Selecting a file saves it immediately to your uploaded files list.</p>
        <ul id="history-list" class="history-list">
          {% if uploaded_excel_files %}
            {% for file in uploaded_excel_files %}
              <li class="history-item">
                <div class="history-name">{{ file.display_name }}</div>
                <div class="history-desc">{{ file.description or 'No description yet.' }}</div>
                <div class="history-meta">{{ file.modified_at }} - {{ file.size_label }}</div>
                <a class="history-open" href="/contacts/{{ file.name|urlencode }}">
                  <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path
                      d="M5 12h14"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M13 5l7 7-7 7"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  Open
                </a>
              </li>
            {% endfor %}
          {% else %}
            <li class="history-empty">No contacts files uploaded yet.</li>
          {% endif %}
        </ul>
      </aside>

      <aside class="sidebar sidebar-phone">
        <h2 class="sidebar-title">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path
              d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.79 19.79 0 0 1 2.08 4.18 2 2 0 0 1 4.06 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          Direct Number (Optional)
        </h2>
        <p class="small">
          Use this only when sending to one person directly.
        </p>
        <label>
          Phone Number
          <input
            type="text"
            name="phone"
            id="phone-input"
            placeholder="81777444 or 96181777444"
            form="send-form"
          >
        </label>
      </aside>
    </div>

    <main class="card">
      <header class="header">
        <h1 class="brand">
          <span class="brand-mark" aria-hidden="true">
            <svg class="brand-icon" viewBox="0 0 24 24" fill="none">
              <path
                d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </span>
          WhatsApp Sender
        </h1>
        <p class="small">
          Default country code for local numbers: +{{ default_country_code }}
        </p>
      </header>

      <div id="status" class="status hidden"></div>

      <form id="send-form" method="post" enctype="multipart/form-data">
        <div class="send-layout">
          <div class="send-main">
            <label>
              Message
              <textarea
                name="message"
                id="message-input"
                dir="auto"
                placeholder="Write text message. If you choose media, this is used as caption."
              >{{- default_message_template -}}</textarea>
            </label>

            <p class="small">
              Use contacts variables inside message like <code>{% raw %}{{name}}{% endraw %}</code> or <code>{% raw %}{{password}}{% endraw %}</code>.
            </p>

            <label>
              Media
              <input type="file" name="media" accept="image/*,video/*,.pdf,.doc,.docx,.txt">
            </label>

            <label>
              Select Existing Contacts File
              <select name="existing_contacts_file" id="existing-contacts-select">
                <option value="">-- Select saved contacts file --</option>
                {% for file in uploaded_excel_files %}
                  <option value="{{ file.name }}" {% if selected_existing_contacts_file == file.name %}selected{% endif %}>
                    {{ file.display_name }} ({{ file.modified_at }})
                  </option>
                {% endfor %}
              </select>
            </label>

            <p class="small">
              Contacts file (.xlsx or .csv) must include a column named <strong>NUMBERS</strong>. Other columns can be used as variables.
            </p>

            <div class="form-actions">
              <button id="send-button" type="submit">
                <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path
                    d="M22 2L11 13"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M22 2l-7 20-4-9-9-4 20-7z"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
                Send
              </button>
              <button id="logout-button" type="button" class="secondary">
                <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path
                    d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M16 17l5-5-5-5"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M21 12H9"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
                Logout
              </button>
            </div>
            <p class="small">
              Session stays active between sends for stability. Use Logout to end the WhatsApp session.
            </p>
          </div>
        </div>
      </form>
    </main>
  </div>

  <div id="qr-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="qr-title">
    <div class="modal-card">
      <h2 id="qr-title">WhatsApp Login</h2>
      <p id="qr-message" class="modal-message">Preparing login...</p>
      <div id="qr-loader" class="loader"></div>
      <img id="qr-image" class="qr-image hidden" alt="WhatsApp QR code">
      <div class="modal-actions">
        <button id="close-modal" type="button" class="secondary">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path
              d="M18 6L6 18"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M6 6l12 12"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          Close
        </button>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/runtime_keepalive.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/index.js') }}" defer></script>
</body>
</html>
